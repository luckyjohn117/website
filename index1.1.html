<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="styles1.1.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <div class="page">
      <div class="left-rail">
        <div class="name-wrap">
          <canvas
            id="pixName"
            width="650"
            height="190"
            aria-hidden="true"
          ></canvas>
          <span class="sr-only">Max Daly</span>
        </div>

        <div>
          <p class="logline">
            COPYWRITER / OLYMPIC GOLD
            <span class="logline-break">MEDALIST / LIAR</span>
          </p>
        </div>
        <div class="projectswrapper">
          <p class="projectsheader">PAST WORK:</p>
          <!-- Links to open mailer windows -->
          <p class="project">
            <a href="#" onclick="return openMailer('win1', this);">
              <img class="mail-icon" src="images/Letter.ico" alt="" />
              subj: BETTER THAN LABUBU
            </a>
          </p>
          <p class="project">
            <a href="#" onclick="return openMailer('win2', this);">
              <img class="mail-icon" src="images/Letter.ico" alt="" />
              subj: BUY GOLD
            </a>
          </p>

          <p class="project">
            <a href="#" onclick="return openMailer('win3', this);">
              <img class="mail-icon" src="images/Letter.ico" alt="" />
              subj: FOR THE IRON DEFICIENT GIRLIES
            </a>
          </p>

          <p class="project">
            <a href="#" onclick="return openMailer('win4', this);">
              <img class="mail-icon" src="images/Letter.ico" alt="" />
              subj: ARE YOU AFRAID OF THE DARK
            </a>
          </p>

          <p class="project">
            <a href="#" onclick="return openMailer('win5', this);">
              <img class="mail-icon" src="images/Letter.ico" alt="" />
              subj: KNICKS IN 7
            </a>
          </p>

          <p class="project">
            <a href="#" onclick="return openMailer('win6', this);">
              <img class="mail-icon" src="images/Letter.ico" alt="" />
              subj: WE HAVE GAY STUFF
            </a>
          </p>

          <div class="icon-row">
            <a class="icon" href="mailto:maxkdaly@gmail.com">
              <img src="images/Mailbox with phone.ico" alt="Email icon" />
              <span class="icon-label">EMAIL</span>
            </a>
            <button class="icon" type="button" onclick="openWindow('bioWin')">
              <img src="images/Earth (4 colors).ico" alt="Bio icon" />
              <span class="icon-label">BIO</span>
            </button>
            <button
              class="icon resume-icon"
              type="button"
              onclick="openWindow('resumeWin')"
            >
              <img
                src="images/Writing on list with figures.ico"
                alt="Resume icon"
              />
              <span class="icon-label">RESUME</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Mailer windows -->
      <div id="win1" class="window">
        <div class="titlebar">
          <span>MaxMail.net</span>
          <button onclick="closeWindow('win1')"><span>×</span></button>
        </div>
        <div class="content">
          <img
            class="deferred-image"
            data-src="images/BETTER THAN LABUBU cropped.jpeg"
            alt="mailer"
            loading="lazy"
            decoding="async"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
          />
        </div>
      </div>

      <div id="win2" class="window">
        <div class="titlebar">
          <span>Mailer 2</span>
          <button onclick="closeWindow('win2')"><span>×</span></button>
        </div>
        <div class="content">
          <img
            class="deferred-image"
            data-src="images/BUY GOLD cropped.jpeg"
            alt="mailer"
            loading="lazy"
            decoding="async"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
          />
        </div>
      </div>

      <div id="win3" class="window">
        <div class="titlebar">
          <span>Mailer 3</span>
          <button onclick="closeWindow('win3')"><span>×</span></button>
        </div>
        <div class="content">
          <img
            class="deferred-image"
            data-src="images/FOR THE IRON DEFICIENT GIRLIES cropped.jpeg"
            alt="mailer"
            loading="lazy"
            decoding="async"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
          />
        </div>
      </div>
      <div id="win4" class="window">
        <div class="titlebar">
          <span>Mailer 3</span>
          <button onclick="closeWindow('win4')"><span>×</span></button>
        </div>
        <div class="content">
          <img
            class="deferred-image"
            data-src="images/WHO'S AFRAID OF THE DARK cropped.jpeg"
            alt="mailer"
            loading="lazy"
            decoding="async"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
          />
        </div>
      </div>
      <div id="win5" class="window">
        <div class="titlebar">
          <span>Mailer 3</span>
          <button onclick="closeWindow('win5')"><span>×</span></button>
        </div>
        <div class="content">
          <img
            class="deferred-image"
            data-src="images/KNICKS IN 7 cropped.jpeg"
            alt="mailer"
            loading="lazy"
            decoding="async"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
          />
        </div>
      </div>
      <div id="win6" class="window">
        <div class="titlebar">
          <span>Mailer 3</span>
          <button onclick="closeWindow('win6')"><span>×</span></button>
        </div>
        <div class="content">
          <img
            class="deferred-image"
            data-src="images/WE HAVE GAY STUFF cropped.jpeg"
            alt="mailer"
            loading="lazy"
            decoding="async"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
          />
        </div>
      </div>
      <div id="bioWin" class="window">
        <div class="titlebar">
          <span>Bio</span>
          <button onclick="closeWindow('bioWin')"><span>×</span></button>
        </div>
        <div class="content">
          <div class="window-body">
            <p class="bio-body">
              Looking for a fit, sporty, fun-to-be-around can of ham who writes
              like crazy? Look no further! Seriously! Don't look at anyone else!
              Please! Why would you? Waste of time I bet. You can just email me,
              close your laptop, and go do literally anything you want!
            </p>
          </div>
        </div>
      </div>
      <div id="resumeWin" class="window">
        <div class="titlebar">
          <span>Resume</span>
          <button onclick="closeWindow('resumeWin')"><span>×</span></button>
        </div>
        <div class="content">
          <div class="window-body resume-body">
            <img
              src="images/Max Daly_resume.png"
              alt="Resume"
              class="resume-image"
            />
            <p class="resume-link">
              <a
                href="images/Max Daly_resume.pdf"
                target="_blank"
                rel="noopener"
                >Open full resume</a
              >
            </p>
          </div>
        </div>
      </div>

      <!-- Script -->
      <script>
        let topZ = 1000;
        let currentWin = null;
        let activeWin = null;
        let activePointerId = null;
        let currentBar = null;
        let dragStartX = 0,
          dragStartY = 0;
        let winStartX = 0,
          winStartY = 0;

        function isMobileView() {
          return window.matchMedia("(max-width: 800px)").matches;
        }

        function getMobileGap() {
          const raw = getComputedStyle(document.documentElement)
            .getPropertyValue("--mobile-gap")
            .trim();
          const gap = parseFloat(raw);
          return Number.isFinite(gap) ? gap : 0;
        }

        function positionActiveWindowInMobileGap(win) {
          document.querySelectorAll(".window").forEach((w) => {
            w.classList.remove("mobile-slot");
            w.style.removeProperty("top");
            w.style.removeProperty("left");
          });

          if (!win || !isMobileView()) return;

          const page = document.querySelector(".page");
          const wrapper = document.querySelector(".projectswrapper");
          if (!page || !wrapper) return;

          const pageRect = page.getBoundingClientRect();
          const wrapperRect = wrapper.getBoundingClientRect();
          const gap = getMobileGap();
          const gapTop = wrapperRect.top - pageRect.top - gap;
          const winHeight = win.getBoundingClientRect().height;
          const top = Math.max(0, gapTop + Math.max(0, (gap - winHeight) / 2));
          const left = (page.clientWidth - win.offsetWidth) / 2;

          win.classList.add("mobile-slot");
          win.style.top = `${Math.round(top)}px`;
          win.style.left = `${Math.round(left)}px`;
        }

        function loadDeferredImages(win) {
          if (!win) return;
          const images = win.querySelectorAll("img.deferred-image[data-src]");
          images.forEach((img) => {
            const src = img.getAttribute("data-src");
            if (!src) return;
            img.src = src;
            img.removeAttribute("data-src");
          });
        }

        function openWindow(id) {
          const win = document.getElementById(id);
          if (!win) return;
          win.style.display = "flex";
          loadDeferredImages(win);
          bringToFront(win);
        }

        function closeWindow(id) {
          const win = document.getElementById(id);
          win.style.display = "none";
          if (activeWin === win) {
            setActiveWindow(null);
            const next = getTopVisibleWindow();
            if (next) bringToFront(next);
          }
        }

        function bringToFront(elem) {
          topZ++;
          elem.style.zIndex = topZ;
          setActiveWindow(elem);
        }

        function setActiveWindow(win) {
          activeWin = win;
          document.querySelectorAll(".window").forEach((w) => {
            w.classList.toggle("active-window", w === win);
          });
          positionActiveWindowInMobileGap(win);
        }

        function getTopVisibleWindow() {
          const visible = Array.from(
            document.querySelectorAll(".window"),
          ).filter((w) => w.style.display !== "none");
          return visible.sort(
            (a, b) =>
              parseInt(b.style.zIndex || 0) - parseInt(a.style.zIndex || 0),
          )[0];
        }

        function openMailer(id, linkEl) {
          openWindow(id);
          const icon = linkEl.querySelector(".mail-icon");
          if (icon && !icon.dataset.opened) {
            icon.dataset.opened = "true";
            icon.src = "images/White letter (opened).ico";
          }
          return false; // prevent jump
        }

        // dragging for all windows
        const windows = document.querySelectorAll(".window");

        windows.forEach((win) => {
          const bar = win.querySelector(".titlebar");

          win.addEventListener("pointerdown", () => bringToFront(win));

          bar.addEventListener("pointerdown", function (e) {
            if (e.target.closest("button")) return;
            currentWin = win;
            currentBar = bar;
            bringToFront(win);
            const styles = getComputedStyle(win);
            winStartX =
              parseFloat(styles.getPropertyValue("--win-offset-x")) || 0;
            winStartY =
              parseFloat(styles.getPropertyValue("--win-offset-y")) || 0;
            dragStartX = e.clientX;
            dragStartY = e.clientY;
            activePointerId = e.pointerId;
            bar.setPointerCapture(e.pointerId);
            document.addEventListener("pointermove", dragMove);
            document.addEventListener("pointerup", dragStop);
            document.addEventListener("pointercancel", dragStop);
          });
        });

        function dragMove(e) {
          if (!currentWin) return;
          if (activePointerId !== null && e.pointerId !== activePointerId)
            return;
          const dx = e.clientX - dragStartX;
          const dy = e.clientY - dragStartY;
          currentWin.style.setProperty("--win-offset-x", `${winStartX + dx}px`);
          currentWin.style.setProperty("--win-offset-y", `${winStartY + dy}px`);
        }

        function dragStop(e) {
          if (
            activePointerId !== null &&
            e &&
            e.pointerId !== activePointerId
          ) {
            return;
          }
          if (currentBar && activePointerId !== null) {
            try {
              currentBar.releasePointerCapture(activePointerId);
            } catch (err) {
              // ignore release errors for browsers without pointer capture
            }
          }
          currentWin = null;
          currentBar = null;
          activePointerId = null;
          document.removeEventListener("pointermove", dragMove);
          document.removeEventListener("pointerup", dragStop);
          document.removeEventListener("pointercancel", dragStop);
        }

        // existing script...

        function getNameScale() {
          const raw = getComputedStyle(document.documentElement)
            .getPropertyValue("--name-scale")
            .trim();
          const scale = parseFloat(raw);
          return Number.isFinite(scale) && scale > 0 ? scale : 1;
        }

        function drawPixelName() {
          const c = document.getElementById("pixName");
          if (!c) return;
          const ctx = c.getContext("2d");
          const scale = getNameScale();
          c.width = Math.round(650 * scale);
          c.height = Math.round(190 * scale);
          ctx.clearRect(0, 0, c.width, c.height);
          ctx.imageSmoothingEnabled = false;
          ctx.fillStyle = "rgb(45,45,45)";
          ctx.font = `${120 * scale}px 'Times New Roman'`;
          ctx.textBaseline = "top";
          const text = "Max Daly";
          const textWidth = ctx.measureText(text).width;
          const x = (c.width - textWidth) / 2;
          ctx.fillText(text, x, 4 * scale);
        }
        drawPixelName();
        window.addEventListener("resize", () => {
          positionActiveWindowInMobileGap(activeWin);
        });
        window.onload = function () {
          openWindow("win3");
          openWindow("win1");
        };
      </script>
    </div>
  </body>
</html>
